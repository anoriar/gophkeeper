
## Описание проекта:
Gophkeeper - клиент-серверное приложение, позволяющее хранить конфиденциальные данные пользователя.
На сервере реализовано:
- регистрация и аутентификация пользователя по JWT токену
- хранение конфиденциальных записей (entries) в зашифрованном виде
- синхронизация записей по типу

На клиенте реализовано:
- регистрация и аутентификация на сервере
- хранение конфиденциальных данных (entries) разных типов
- синхронизация записей

Реализовано 4 типа данных:
- login - логин и пароль (json: "{\"login\": \"test\", \"password\": \"pass\"}")
- card - данные банковских карт (json: {"number":"1245678","expireDate":"03/28","holder":"Test","cvv":"123"})
- text - произвольные текстовые данные ("text data")
- bin - бинарные данные в формате base64 ("SGVsbG8gV29ybGQ=")

Клиент представляет собой консольное приложение

С клиентом можно работать оффлайн, но только сохранять записи локально. 

Для отправки данных на сервер нужно авторизоваться
Команды клиента:
- register -u [логин] -p [пароль] -m [мастер-пароль]  - регистрация нового пользователя на сервере
- login -u [логин] -p [пароль] -m [мастер-пароль] - авторизация пользователя в системе
- add -t [тип записи] -d [данные] -m [мета] - добавление записи
- edit -t [тип записи] -i [id записи] -d [данные] -m [мета] - редактирование записи
- delete -t [тип записи] -i [id записи] - удаление записи
- detail -t [тип записи] -i [id записи] - детальная информация (в расшифрованном виде)
- list -t [тип записи] - список записей пользователя (без данных)
- sync -t [тип записи] - синхронизация данных по типу


## Описание механизма работы клиента
1. Пользователь зарегистрировался и авторизовался в системе с помощью команды register или login
2. При добавлении новой записи конфиденциальные данные шифруются в байты с помощью синхронного алгоритма шифрования. Мастер пароль является ключом шифрования
После шифрования данные попадают в хранилище уже в зашифрованном виде
3. При синхронизации с сервером: данные определенного типа (который был определен в команде sync -t) отправляются на сервер в json запрос. Байты кодируются в base64
Сервер возвращает все данные, которые должен записать клиент в хранилище по этому типу. Данные обновляются.

## Механизм синхронизации
Данные приходят на сервер в таком виде с клиента
```
{
    "syncType": "login",
    "items": [
       {
            "originalId": "0664b999-fdfc-4f2f-9c35-dace58da6400",
            "data": "YW8f11zfrW0gse6R9eiqc8IHSzOpl5EiURrg+COniWLEG/TXPV/h3Vcgarpl/j/ax9/UAAQxIjhFFJTmWWo=",
            "isDeleted": false,
            "updatedAt": "2020-12-10T15:15:45+00:00",
            "meta": {
                "property1": "string",
                "property2": "string"
            }
        }
    ]
}
```
- syncType - тип данных, которые будем синхронизировать
- originalId - ид записи на клиенте. Если для текущего пользователя нет записей с таким id - сервер создаст новую
- data - зашифрованные данные в формате base64
- isDeleted - удален ли элемент на клиенте. Если true - то запись удаляется с сервера
- updatedAt - дата обновления записи: если дата из запроса старше чем на сервере - запись на сервере обновляется. в противном случае - на клиент присылаются данные этой записи с сервера
- meta - любые метаданные записи в формате json


## Что еще можно реализовать в будущем:
1. Механизм безопасного хранения мастер-пароля
2. Механизм частичной синхронизации
3. Работа с файлами: синхронизация больших файлов. Отдельный механизм хранения файлов на клиенте и сервере (возможно, через s3)
4. Интеграционные тесты
5. Разделение таблицы на сервере entries на несколько по типам (для оптимизации)
6. UI для клиента

## Запуск сервера
1. docker-compose up -d
2. В Goland Add Configuration -> go build
3. Run kind = Directory; Directory = к значению, что ide прописало автоматически, надо добавить ```/cmd/server```
4. ENVIRONMENT скопировать из ```.env.server-example```

## Запуск клиента
Конфигурации команд клиента для Goland закоммичены в репозитории (см EditConfigurations)
Чтобы запустить команду:
1. В Goland Add Configuration -> go build 
2. Run kind = Directory; Directory = к значению, что ide прописало автоматически, надо добавить ```/cmd/client```
3. ENVIRONMENT скопировать из ```.env.client-example```
4. Program arguments = [команда]  Пример: detail -t login -i "54493f7e-b64f-4831-8b38-691768a86d83"

# Убрать лишние импорты + gofmt
goimports -local github.com/anoriar/gophkeeper -w ./

# e2e тест
1. Запустить docker-compose up -d
2. Скомпилировать сервер: cmd/server/main.go
3. Скомпилировать клиент: cmd/client/main.go
4. В Goland Add Configuration -> go test
5. Run kind = Package;
6. ENVIRONMENT Скопировать из ```.env.e2e-example```. SERVER_BIN, CLIENT_BIN - абсолютные пути к скомпилированным файлам сервере и клиента соответственно
